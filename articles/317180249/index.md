---
confluence-id: '317180249'
orig-title: Explicit Congestion Notification - ECN, ECE, CWE, NS, ECT, CE
slug: '317180249'
tags: kb kbtcp kbecn
title: Explicit Congestion Notification - ECN, ECE, CWE, NS, ECT, CE
version: 8
---

<ac:layout><ac:layout-section ac:type="two_equal"><ac:layout-cell><ac:structured-macro ac:name="excerpt" ac:schema-version="1" ac:macro-id="2a6e168f-b284-4015-a70f-5110bdc4ede8"><ac:parameter ac:name="atlassian-macro-output-type">INLINE</ac:parameter><ac:rich-text-body><p>ECN is a mechanism in TCP/IP where routers can signal that they are <em>almost</em> overloaded. This lets endpoints slow down before packet-loss actually occurs.<br /><br />As of v12.00.24 and v13.00.06, the TCPECN setting in Clavister cOS Core defaults to &quot;Ignore&quot;, meaning that it passes the ECN-related bits through, unmodified.</p></ac:rich-text-body></ac:structured-macro><p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="b14ec6bf-c24f-4c52-ae96-1779f5f720df" /></p></ac:layout-cell><ac:layout-cell><ac:structured-macro ac:name="details" ac:schema-version="1" ac:macro-id="d6c80c04-42e9-45c0-8446-1df87ed8ca22"><ac:rich-text-body><table class="wrapped"><colgroup> <col /> <col /> </colgroup><tbody><tr><td><p>Up to date for</p></td><td><p>Core 12.00.24, 13.00.06</p></td></tr><tr><td colspan="1">Status</td><td colspan="1"><div class="content-wrapper"><p><ac:structured-macro ac:name="status" ac:schema-version="1" ac:macro-id="000e7e8f-43e7-42ba-90a3-a0bc34ddfd27"><ac:parameter ac:name="colour">Green</ac:parameter><ac:parameter ac:name="title">OK</ac:parameter></ac:structured-macro>&nbsp;</p><p><ac:placeholder>DRAFT: still working on this </ac:placeholder></p><p><ac:placeholder>OK: usable (doesn't have to mean final!) </ac:placeholder></p><p><ac:placeholder>OLD: information is out of date </ac:placeholder></p><p><ac:placeholder>NEVERPUBLIC: never consider it for publication.</ac:placeholder></p></div></td></tr></tbody></table></ac:rich-text-body></ac:structured-macro></ac:layout-cell></ac:layout-section><ac:layout-section ac:type="single"><ac:layout-cell><h1>Signalling Congestion - forward direction - IP header</h1><p><ac:image ac:align="right" ac:title="Evolution of IP header ToS bits into DSCP and ECN" ac:alt="Evolution of IP header ToS bits into DSCP and ECN" ac:width="400"><ri:attachment ri:filename="ip-header-ecn-bits-history.svg" /></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2020-5-23_17-34-34.png" /></ac:image></p><ul><li><code>00</code> &ndash; Non ECN-Capable Transport, Non-ECT</li><li><code>10</code> &ndash; ECN Capable Transport, ECT(0)</li><li><code>01</code> &ndash; ECN Capable Transport, ECT(1)</li><li><code>11</code> &ndash; Congestion Encountered, CE.</li></ul><p>So, if the sender sets the bits to &quot;00&quot;, no router will mark the packet as congested, as they then assume ECN is not supported.</p><p><br /></p><h1>Notifying the sender - return direction - TCP header</h1><p>When a host receives &quot;Congestion Encountered, CE&quot; in the IP header of a packet, it has to somehow notify the sender of this for it to be useful.</p><p>For a TCP connection, this happens in the TCP ACK packet returned.</p><p><ac:image ac:width="800"><ri:attachment ri:filename="image2020-5-23_17-48-51.png" /></ac:image></p><ul><li><p>ECE - Echo of Congestion Encountered - starts being set in TCP packets when &quot;CE&quot; is seen</p></li><li>CWR - Congestion Window Reduced = &quot;OK, I saw your ECE, you can turn it off now&quot;</li><li>NS = Nonce Sum <a href="https://tools.ietf.org/html/rfc3540">RFC3540</a> was meant to improve robustness of the protocol but was never standardized. The bit assignment still remains in the specification, however, and should be treated the same way as ECE and CWD - either passed-on, or stripped.</li></ul><h1>Problems with firewalls</h1><p>ECE and CWR were not defined in the original TCP specification, and were often referred to as &quot;christmas-tree lamp test&quot; bits- XMAS and, naturally, YMAS.</p><p>Firewalls long took them as an indication of &quot;something fishy&quot; going on and defaulted to blocking packets that had them set, leading to ECN-enabled TCP connections breaking.</p><p>See <a href="https://tools.ietf.org/html/bcp60">BCP60 - Inappropriate TCP Resets Considered Harmful</a> by ECN wizard Sally Floyd for a write-up on this subject. (And yes the Mikael Olsson in the Acknowledgements sections is ours)</p><h2>ECN in cOS Core</h2><p>Clavister cOS Core has long defaulted to <em>stripping</em> the ECN bits which does not break TCP, but does disable ECN. This due to the fact that there have been bugs in endpoints (and, notably, other firewalls, e.g. <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2001-0183">CVE-2001-0183 - FreeBSD ipfw allowing ruleset bypass with ECE bit set</a>) related to this bit, and the simple fact that ECN functionality was only recently widely-enabled by default.</p><p>cOS Core's behavior is controlled by the &quot;TCPECN&quot; setting.</p><p>As of mid 2020, v12.00.24 and v13.00.06, the TCPECN setting defaults to <strong>&quot;Ignore</strong>&quot;, meaning that it passes the ECN-related bits through, <strong>unmodified</strong>.</p><p><br /></p><h1>Further reading</h1><ul><li><a href="https://en.wikipedia.org/wiki/Explicit_Congestion_Notification">https://en.wikipedia.org/wiki/Explicit_Congestion_Notification</a></li><li><a href="https://tools.ietf.org/html/rfc8087">RFC8087 - The Benefits of Using Explicit Congestion Notification (ECN)</a></li></ul></ac:layout-cell></ac:layout-section><ac:layout-section ac:type="single"><ac:layout-cell><h1>Related articles</h1><p><ac:structured-macro ac:name="contentbylabel" ac:schema-version="3" ac:macro-id="cc15d669-a127-47d6-b309-0399a017f1db"><ac:parameter ac:name="sort">modified</ac:parameter><ac:parameter ac:name="excerptType">rich content</ac:parameter><ac:parameter ac:name="cql">label in (&quot;kbtcp&quot;,&quot;kbecn&quot;) and type = &quot;page&quot;</ac:parameter></ac:structured-macro></p><p><ac:placeholder> Change the labels in the macro to match suitably narrow labels, e.g. &quot;kbdhcp, kbrouting&quot; but not &quot;kbcore&quot;/&quot;kbhowto&quot;/&quot;kb&quot;/&quot;kbdictionary&quot;. Pages with ANY of the labels will be shown - it's _not_ a &quot;must match all&quot; filter. (You can of course use as much advanced filtering as you like!) </ac:placeholder></p><p><br /></p><p><br /></p></ac:layout-cell></ac:layout-section></ac:layout>